<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>REST APIs with plumber :: Cheatsheet</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../html/images/posit-favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../html/css/cheatsheet.css">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="https://posit.co" class="navbar-brand navbar-brand-logo">
    <img src="../html/images/posit-logo.png" alt="posit logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Posit Cheatsheets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contributed-cheatsheets.html" rel="" target="">
 <span class="menu-text">Contributed Cheatsheets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../translations.html" rel="" target="">
 <span class="menu-text">Translated Cheatsheets</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rstudio/cheatsheets" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-rest-apis" id="toc-introduction-to-rest-apis" class="nav-link active" data-scroll-target="#introduction-to-rest-apis">Introduction to REST APIs</a>
  <ul class="collapse">
  <li><a href="#http" id="toc-http" class="nav-link" data-scroll-target="#http">HTTP</a></li>
  <li><a href="#request" id="toc-request" class="nav-link" data-scroll-target="#request">Request</a></li>
  <li><a href="#response" id="toc-response" class="nav-link" data-scroll-target="#response">Response</a></li>
  </ul></li>
  <li><a href="#plumber-build-apis-with-r" id="toc-plumber-build-apis-with-r" class="nav-link" data-scroll-target="#plumber-build-apis-with-r">Plumber: Build APIs with R</a></li>
  <li><a href="#plumber-piperline" id="toc-plumber-piperline" class="nav-link" data-scroll-target="#plumber-piperline">Plumber piperline</a></li>
  <li><a href="#running-plumber-apis" id="toc-running-plumber-apis" class="nav-link" data-scroll-target="#running-plumber-apis">Running Plumber APIs</a>
  <ul class="collapse">
  <li><a href="#ide-integration" id="toc-ide-integration" class="nav-link" data-scroll-target="#ide-integration">IDE Integration</a></li>
  </ul></li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation">Documentation</a></li>
  <li><a href="#interact-with-the-api" id="toc-interact-with-the-api" class="nav-link" data-scroll-target="#interact-with-the-api">Interact with the API</a></li>
  <li><a href="#programmatic-plumber" id="toc-programmatic-plumber" class="nav-link" data-scroll-target="#programmatic-plumber">Programmatic Plumber</a>
  <ul class="collapse">
  <li><a href="#tidy-plumber" id="toc-tidy-plumber" class="nav-link" data-scroll-target="#tidy-plumber">Tidy Plumber</a></li>
  <li><a href="#openapi" id="toc-openapi" class="nav-link" data-scroll-target="#openapi">OpenAPI</a></li>
  </ul></li>
  <li><a href="#advanced-plumber" id="toc-advanced-plumber" class="nav-link" data-scroll-target="#advanced-plumber">Advanced Plumber</a>
  <ul class="collapse">
  <li><a href="#request-and-response" id="toc-request-and-response" class="nav-link" data-scroll-target="#request-and-response">Request and Response</a></li>
  <li><a href="#async-plumber" id="toc-async-plumber" class="nav-link" data-scroll-target="#async-plumber">Async Plumber</a></li>
  <li><a href="#mounting-routers" id="toc-mounting-routers" class="nav-link" data-scroll-target="#mounting-routers">Mounting Routers</a></li>
  <li><a href="#running-examples" id="toc-running-examples" class="nav-link" data-scroll-target="#running-examples">Running Examples</a></li>
  </ul></li>
  <li><a href="#deploying-plumber-apis" id="toc-deploying-plumber-apis" class="nav-link" data-scroll-target="#deploying-plumber-apis">Deploying Plumber APIs</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/rstudio/cheatsheets/edit/main/html/plumber.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/rstudio/cheatsheets/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">REST APIs with plumber :: Cheatsheet</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>


<div class="no-row-height column-margin column-container"><div class="cell">
<img src="images/logo-plumber.png" height="138" alt="Hex logo for plumber - the word 'plumber' written in green, where the letters are depicted as water pipes, which connect to the border of the logo. The background is a series of criss-crossing pipes in shades of black and grey."> <br><br><a href="../plumber.pdf">
<p>
<i class="bi bi-file-pdf"></i> Download PDF
</p>
</a><p><a href="../plumber.pdf"><img src="../pngs/plumber.png" width="200" alt=""> </a> <br><br></p>
</div></div><section id="introduction-to-rest-apis" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-rest-apis">Introduction to REST APIs</h2>
<p>Web APIs use <strong>HTTP</strong> to communcation between <strong>client</strong> and <strong>server</strong>.</p>
<section id="http" class="level3">
<h3 class="anchored" data-anchor-id="http">HTTP</h3>
<p>HTTP is built around a <strong>request</strong> and a <strong>response</strong>. A <strong>client</strong> makes a request to a <strong>server</strong>, which handles the request and provides a response. Requests and responses are specially formatted text containing details and data about the exchange between client and server.</p>
</section>
<section id="request" class="level3">
<h3 class="anchored" data-anchor-id="request">Request</h3>
<p><code>GET / get HTTP/1.1</code> -&gt; HTTP Method, Path, HTTP Version</p>
<p><code>Host:</code>, <code>User-Agent:</code>, <code>Accept:</code> -&gt; Headers</p>
<p><code>Request Body</code> -&gt; Message body</p>
<pre><code>curl -v "http://httpbin.org/get"

#&gt; GET / get HTTP/1.1
#&gt; Host: httpbin.org
#&gt; User-Agent: curl/7.55.1
#&gt; Accept: */*
#
# Request Body</code></pre>
</section>
<section id="response" class="level3">
<h3 class="anchored" data-anchor-id="response">Response</h3>
<p><code>HTTP/1.1 200 OK</code> -&gt; HTTP Version, Status code, Reason phrase</p>
<p><code>Connection:</code>, <code>Date:</code> -&gt; Headers</p>
<p><code>Response Body</code> -&gt; Message body</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&lt; HTTP/1.1 200 OK</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&lt; Connection: keep-alive</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&lt; Date: Thu, 02 Aug 2018 18:22:22 GMT</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Response Body</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plumber-build-apis-with-r" class="level2">
<h2 class="anchored" data-anchor-id="plumber-build-apis-with-r">Plumber: Build APIs with R</h2>
<p>Plumber uses special comments to turn any arbitrary R code into API endpoints. The example below defines a function that takes the <code>msg</code> argument and returns it embedded in additional text.</p>
<p>Plumber comments begin with <code>#*</code> and <code>@</code> decoators define API characteristics. In HTTP methods such as <code>@get</code> the <code>/&lt;path&gt;</code> defines the location of the endpoint.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#* @apiTitle Plumber Example API</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#* Echo back the input</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#* @param msg The message to echo</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#* @get /echo</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(<span class="at">msg =</span> <span class="st">""</span>) {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">msg =</span> <span class="fu">paste0</span>(<span class="st">"The message is: '"</span>, msg, <span class="st">"'"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plumber-piperline" class="level2">
<h2 class="anchored" data-anchor-id="plumber-piperline">Plumber piperline</h2>
<p>Plumber endpoints contain R code that is executed in response to an HTTP request. Incoming requests pass through a set of mechanisms before a response is returned to the client.</p>
<ul>
<li><p>Filters: Filters can forward requests (after potentially mutating them), throw errors, or return a response without forwarding the request. Filters are defined similarly to endpoints using the <code>@filter [name]</code> tag. By default, filters apply to all endpoints. Endpoints can opt out of filters using the <code>@preempt</code> tag.</p></li>
<li><p>Parsers: Parsers determine how Plumber parses the incoming request body. By default Plumber parses the request body as JavaScript Object Notation (JSON). Other parsers, including custom parsers, are identified using the <code>@parser [parser name]</code> tag. All registered parsers can be viewed with <code>registered_parsers()</code>.</p></li>
<li><p>Endpoint: Endpoints define the R code that is executed in response to incoming requests. These endpoints correspond to HTTP methods and respond to incoming requests that match the defined method.</p>
<ul>
<li><p>Methods</p>
<ul>
<li><code>@get</code> - request a resource</li>
<li><code>@post</code> - send data in body</li>
<li><code>@put</code> - store/update data</li>
<li><code>@delete</code> - delete resource</li>
<li><code>@head</code> - no request body</li>
<li><code>@options</code> - describe options</li>
<li><code>@patch</code> - partial changes</li>
<li><code>@use</code> - use all methods</li>
</ul></li>
</ul></li>
<li><p>Serializer: Serializers determine how Plumber returns results to the client. By default Plumber serializes the R object returned into JavaScript Object Notation (JSON). Other serializers, including custom serializers, are identified using the <code>@serializer [serializer name]</code> tag. All registered serializers can be viewed with <code>registered_serializers()</code>.</p></li>
</ul>
<p>Identify as filter with <code>@filter</code>, filter name is <code>log</code>, and forward request with <code>forward()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#* @filter log</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(req, res) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(req<span class="sc">$</span>HTTP_USER_AGENT)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forward</span>()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define the endpoint description, opt out of the log filter, define the parser, HTTP method and endpoint path, and serializer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#* Convert request body to uppercase</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#* @prempt log</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#* @parser json</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#* @post /uppercase</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#* @serializer json</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(req, res) {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toupper</span>(req<span class="sc">$</span>body)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-plumber-apis" class="level2">
<h2 class="anchored" data-anchor-id="running-plumber-apis">Running Plumber APIs</h2>
<p>Plumber APIs can be run programmatically from within an R session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Path to API definition</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plumb</span>(<span class="st">"plumber.R"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pr_run</span>(<span class="at">port =</span> <span class="dv">5762</span>) <span class="co"># Specify API port</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This runs the API on the host machine supported by the current R session.</p>
<section id="ide-integration" class="level3">
<h3 class="anchored" data-anchor-id="ide-integration">IDE Integration</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/plumber-ide.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand to read about plumber features in the RStudio IDE
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<section id="plumber-features-in-the-rstudio-ide" class="level3 callout-body-container callout-body">
<h3 class="anchored" data-anchor-id="plumber-features-in-the-rstudio-ide">plumber features in the RStudio IDE</h3>
<ul>
<li>Create new Plumber API</li>
<li>Publish API to RStudio Connect</li>
<li>Run API in current R session</li>
</ul>
</section>
</div>
</div>
</section>
</section>
<section id="documentation" class="level2">
<h2 class="anchored" data-anchor-id="documentation">Documentation</h2>
<p>Plumber APIs automatically generate an OpenAPI specification file. This specification file can be interpreted to generate a dynamic user-interface for the API. The default interface is generated via Swagger</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/plumber-documentation.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand to read about the Swagger user interface
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<section id="features-in-the-swagger-user-interface" class="level3 callout-body-container callout-body">
<h3 class="anchored" data-anchor-id="features-in-the-swagger-user-interface">Features in the Swagger user interface</h3>
<ul>
<li>Endpoint details</li>
<li>Parameter details</li>
<li>Edit parameters</li>
<li>Send request</li>
<li>curl command used to send request</li>
</ul>
</section>
</div>
</div>
</section>
<section id="interact-with-the-api" class="level2">
<h2 class="anchored" data-anchor-id="interact-with-the-api">Interact with the API</h2>
<p>Once the API is running, it can be interacted with using any HTTP client. Note that using <code>httr</code> requires using a separate R session from the one serving the API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="st">"localhost:5762/echo?msg=Hello"</span>)) </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Response [http://localhost:5762/echo?msg=Hello] </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #&gt; Date: 2018-08-07 20:06</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Status: 200</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Content-Type: application/json</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Size: 35 B</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>httr<span class="sc">::</span><span class="fu">content</span>(resp, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "{\"msg\":[\"The message is: 'Hello'\"]}"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- Page 2 -->
</section>
<section id="programmatic-plumber" class="level2">
<h2 class="anchored" data-anchor-id="programmatic-plumber">Programmatic Plumber</h2>
<section id="tidy-plumber" class="level3">
<h3 class="anchored" data-anchor-id="tidy-plumber">Tidy Plumber</h3>
<p>Plumber is exceptionally customizable. In addition to using special comments to create APIs, APIs can be created entirely programatically. This exposes additional features and functionality. Plumber has a convenient “tidy” interface that allows API routers to be built piece by piece. The following example is part of a standard <code>plumber.R</code> file.</p>
<p>Use the <code>@plumber</code> tag, create a function that accepts and modifies a plumber router (<code>pr</code>), and use “tidy functions” like <code>pr_get()</code> and <code>pr_post()</code> for buildings out Plumber API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#* @plumber</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(pr) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  pr <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pr_get</span>(<span class="at">path =</span> <span class="st">"/echo"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">handler =</span> <span class="cf">function</span>(<span class="at">msg =</span> <span class="st">""</span>) {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(<span class="at">msg =</span> <span class="fu">paste0</span>(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"The message is: '"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>               msg,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">"'"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>           }) <span class="sc">|&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pr_get</span>(<span class="at">path =</span> <span class="st">"/plot"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">handler =</span> <span class="cf">function</span>() {</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>             rand <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">hist</span>(rand)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>           },</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">serializer =</span> <span class="fu">serializer_png</span>()) <span class="sc">|&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pr_post</span>(<span class="at">path =</span> <span class="st">"/sum"</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">handler =</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as.numeric</span>(a) <span class="sc">+</span> <span class="fu">as.numeric</span>(b)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="openapi" class="level3">
<h3 class="anchored" data-anchor-id="openapi">OpenAPI</h3>
<p>Plumber automatically creates an OpenAPI specification file based on Plumber componenets. This file can be further modified using <code>pr_set_api_spec()</code> with either a function that modifies the existing specification or a path to a <code>.yaml</code> or <code>.json</code> specification file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#* @param msg The message to echo</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#* @get /echo</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(<span class="at">msg =</span> <span class="st">""</span>) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">msg =</span> <span class="fu">paste0</span>(<span class="st">"The messahe is: '"</span>, msg, <span class="st">"'"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#* @plumber</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(pr) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  pr <span class="sc">|&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pr_set_api_spec</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(spec) {</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        spec<span class="sc">$</span>paths[[<span class="st">"echo"</span>]]<span class="sc">$</span>get<span class="sc">$</span>summary <span class="ot">&lt;-</span> <span class="st">"Echo back the input"</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        spec <span class="co"># Return the updated specification</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, Swagger is used to interpret the OpenAPI specification file and generate the user interface for the API. Other interpreters can be used to adjust the look and feel of the user interface via <code>pr_set_docs()</code>.</p>
</section>
</section>
<section id="advanced-plumber" class="level2">
<h2 class="anchored" data-anchor-id="advanced-plumber">Advanced Plumber</h2>
<section id="request-and-response" class="level3">
<h3 class="anchored" data-anchor-id="request-and-response">Request and Response</h3>
<p>Plumber provides access to special <code>req</code> and <code>res</code> objects that can be passed to Plumber functions. These objects provide access to the request submitted by the client and the response that will be sent to the client. Each object has several components, the most helpful of which are outlined below:</p>
<p><strong>Request Objects</strong></p>
<table class="table">
<caption>Table of request object names, examples, and descriptions</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>req$pr</code></td>
<td><code>plumber::pr()</code></td>
<td>The Plumber router processing the request</td>
</tr>
<tr class="even">
<td><code>req$body</code></td>
<td><code>list(a = 1)</code></td>
<td>Typically the same as <code>argsBody</code></td>
</tr>
<tr class="odd">
<td><code>req$argsBody</code></td>
<td><code>list(a = 1)</code></td>
<td>The parsed body output</td>
</tr>
<tr class="even">
<td><code>req$argsPath</code></td>
<td><code>list(c = 3)</code></td>
<td>The values of the path arguments</td>
</tr>
<tr class="odd">
<td><code>req$argsQuery</code></td>
<td><code>list(e = 5)</code></td>
<td>The parsed output from <code>req$QUERY_STRING</code></td>
</tr>
<tr class="even">
<td><code>req$cookies</code></td>
<td><code>list(cook = "a")</code></td>
<td>A list of cookies</td>
</tr>
<tr class="odd">
<td><code>req$REQUEST_METHOD</code></td>
<td><code>"GET"</code></td>
<td>The method used for the HTTP request</td>
</tr>
<tr class="even">
<td><code>req$PATH_INFO</code></td>
<td><code>"/"</code></td>
<td>The path of the incoming HTTP request</td>
</tr>
<tr class="odd">
<td><code>req$HTTP_*</code></td>
<td><code>"HTTP_USER_AGENT"</code></td>
<td>All of the HTTP headers sent with the request</td>
</tr>
<tr class="even">
<td><code>req$bodyRaw</code></td>
<td><code>charToRaw("a = 1")</code></td>
<td>The <code>raw()</code> contents of the request body</td>
</tr>
</tbody>
</table>
<p><strong>Response Objects</strong></p>
<table class="table">
<caption>Table of response object names, examples, and descriptions</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 30%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>res$headers</code></td>
<td><code>list(header = "abc")</code></td>
<td>HTTP headers to include in the response</td>
</tr>
<tr class="even">
<td><code>res$setHeader()</code></td>
<td><code>setHeader("foo", "bar")</code></td>
<td>Sets an HTTP header</td>
</tr>
<tr class="odd">
<td><code>res$setCookie()</code></td>
<td><code>setCookie("foo", "bar")</code></td>
<td>Sets an HTTP cookie on the client</td>
</tr>
<tr class="even">
<td><code>res$removeCookie()</code></td>
<td><code>removeCookie("foo")</code></td>
<td>Removes an HTTP cooki4</td>
</tr>
<tr class="odd">
<td><code>res$body</code></td>
<td><code>"{\"a\":[1]}"</code></td>
<td>Serialized output</td>
</tr>
<tr class="even">
<td><code>res$status</code></td>
<td><code>200</code></td>
<td>The response HTTP status code</td>
</tr>
<tr class="odd">
<td><code>res$toResponse()</code></td>
<td><code>toResponse()</code></td>
<td>A list of <code>status</code>, <code>headers</code>, and <code>body</code></td>
</tr>
</tbody>
</table>
</section>
<section id="async-plumber" class="level3">
<h3 class="anchored" data-anchor-id="async-plumber">Async Plumber</h3>
<p>Plumber supports asynchronous execution via the <strong>future</strong> R package. This pattern allows Plumber to concurrently process multiple requests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the execution plan</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(<span class="st">"multisession"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#* @get /slow</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>() {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  promises<span class="sc">::</span><span class="fu">future_promise</span>({</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slow_calc</span>() <span class="co"># Slow calculation</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mounting-routers" class="level3">
<h3 class="anchored" data-anchor-id="mounting-routers">Mounting Routers</h3>
<p>Plumber routers can be combined by mounting routers into other routers. This can be beneficial when building routers that involve several different endpoints and you want to break each component out into a separate router. These separate routers can even be separate files loaded using <code>plumb()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an initial router</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>route <span class="ot">&lt;-</span> <span class="fu">pr</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pr_get</span>(<span class="st">"/foo"</span>, <span class="cf">function</span>() <span class="st">"foo"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#* @plumber</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(pr) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  pr <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pr_mount</span>(<span class="st">"/bar"</span>, route)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above example, the final route is <code>/bar/foo</code>.</p>
</section>
<section id="running-examples" class="level3">
<h3 class="anchored" data-anchor-id="running-examples">Running Examples</h3>
<p>Some packages, like the Plumber package itself, may include example Plumber APIs. Available APIs can be viewed using <code>available_apis()</code>. These example APIs can be run with <code>plumb_api()</code> combined with <code>pr_run()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plumb_api</span>(<span class="at">package =</span> <span class="st">"plumber"</span>, <span class="co"># package name</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">"01-append"</span>, <span class="co"># API name</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">edit =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="co"># optionally open the file for editing</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pr_run</span>() <span class="co"># run the example API</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="deploying-plumber-apis" class="level2">
<h2 class="anchored" data-anchor-id="deploying-plumber-apis">Deploying Plumber APIs</h2>
<p>Once Plumber APIs have been developed, they often need to be deployed somewhere to be useful. Plumber APIs can be deployed in a variety of different ways. One of the easiest way to deploy Plumber APIs is using RStudio Connect, which supports push button publishing from the RStudio IDE.</p>
<hr>
<p>CC BY SA Posit Software, PBC • <a href="mailto:info@posit.co">info@posit.co</a> • <a href="https://posit.co">posit.co</a></p>
<p>Learn more at <a href="https://www.rplumber.io/">rplumber.io</a>.</p>
<p>Updated: 2023-06.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">packageVersion</span>(<span class="st">"plumber"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '1.2.1'</code></pre>
</div>
</div>
<hr>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>